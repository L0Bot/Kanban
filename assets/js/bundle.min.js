!function(){var t="http://localhost:5000";const e={makeTagInDOM:function(t){const o=document.createElement("span");o.classList.add("tag"),o.style.backgroundColor=t.color,o.textContent=t.name,o.setAttribute("data-tag-id",t.id);const a=t.card_has_tag.card_id,n=document.querySelector(`.columns [data-card-id="${a}"] .tags`);n.addEventListener("dblclick",e.handleDeleteTagFromCard),n.appendChild(o)},handleDeleteTagFromCard:async function(e){if(!confirm("voulez vous vraiment supprimer cette carte ? "))return;const o=e.target.closest(".box").getAttribute("data-card-id"),a=e.target.getAttribute("data-tag-id");try{const n=await fetch(`${t}/cards/${o}/tag/${a}`,{method:"DELETE"});console.log(n),204===n.status&&e.target.remove()}catch(n){console.log(n)}}};var o=e;const a={makeCardInDom(t){console.log(t);const e=document.querySelector("#card-template").content.cloneNode(!0);e.querySelector(".box").style.backgroundColor=t.color,e.querySelector(".box .column").textContent=t.title,e.querySelector(".box").setAttribute("data-card-id",t.id),e.querySelector(".edit-card-icon").addEventListener("click",a.handleDisplayEditCardForm),e.querySelector(".delete-card-icon").addEventListener("click",a.handleDeleteCard),e.querySelector("form").addEventListener("submit",a.handleEditSubmitForm),e.querySelector("input").value=t.id;const o=t.color;e.querySelector(".is-small").nextElementSibling.value=o,console.log("DATA",t),console.log(t.list_id),document.querySelector(`[data-list-id="${t.list_id}"] .has-background-light`).appendChild(e)},handleDisplayEditCardForm:function(t){const e=t.target.closest(".columns");e.querySelector("form").classList.remove("is-hidden"),e.querySelector(".column").classList.add("is-hidden");const o=e.querySelector(".column").textContent,a=t.target.closest(".columns").querySelector(".is-small");a.value=o,console.log(a.nextElementSibling)},handleDeleteCard:async function(e){if(e.preventDefault(),!confirm("voulez-vous vraiment supprimer cette carte ? "))return;const o=e.target.closest(".box").dataset.cardId;try{204===(await fetch(`${t}/cards/${o}`,{method:"DELETE"})).status&&e.target.closest(".box").remove()}catch(a){console.log(a)}},handleAddCardForm:async function(e){e.preventDefault();const o=new FormData(e.target);a.handleButtonsHideCardModalElem();try{const e=await fetch(t+"/cards",{method:"POST",body:o});if(console.log("rep",e),201!==e.status)throw new Error("POST API issue");{const t=await e.json();a.makeCardInDom(t)}}catch(n){console.log(n)}},handleEditSubmitForm:async function(e){e.preventDefault();const o=new FormData(e.target);try{if(console.log("on passe l\xe0 "),!o.get("title"))throw alert("Form issue"),new Error("form issue");const a=await fetch(`${t}/cards/${o.get("card-id")}`,{method:"PATCH",body:o}),n=await a.json();e.target.closest(".columns").querySelector(".column").textContent=n.title,e.target.closest(".box").style.backgroundColor=n.color}catch(a){console.log(a)}e.target.closest(".columns").querySelector("form").classList.add("is-hidden"),e.target.closest(".columns").querySelector(".column").classList.remove("is-hidden")},handleButtonsHideCardModalElem:function(){document.querySelector("#addCardModal").classList.remove("is-active")},handleButtonShowCardModal:function(t){const e=document.querySelector("#addCardModal"),o=t.target.closest(".panel").getAttribute("data-list-id");e.querySelector("#input-card-id").value=o,e.classList.add("is-active")}};var n=a;const s={makeListInDOM(t){const e=document.querySelector("#list-template").content.cloneNode(!0);console.log(e),e.querySelector("h2").textContent=t.name,e.querySelector(".is-one-quarter").setAttribute("data-list-id",t.id),e.querySelector("input").value=t.id,e.querySelector(".panel .is-pulled-right").addEventListener("click",n.handleButtonShowCardModal),e.querySelector("h2").addEventListener("dblclick",s.handleShowEditForm),e.querySelector("form").addEventListener("submit",s.handleSubmitEditList),e.querySelector(".delete-list").addEventListener("click",s.handleDeleteList),s.initDragNDrop(e),document.querySelector(".card-lists").appendChild(e)},initDragNDrop:function(t){const e=t.querySelector(".panel-block");new Sortable(e,{group:"lists",draggable:".box",onEnd:s.handleDragCard})},updateCardPosition:async function(e,o){try{const a=new FormData;let n=1;for(const s of e){const e=s.getAttribute("data-card-id");console.log(e),a.set("id",e),a.set("position",n),//!! Information capitale pour changer la position de la carte ! 
a.set("list_id",o),await fetch(`${t}/cards/${e}`,{method:"PATCH",body:a}),n++}}catch(a){console.log(a)}},handleDragList:async function(e){const o=document.querySelectorAll(".panel"),a=new FormData;o.forEach(async(e,o)=>{console.log(o),a.set("position",o),a.set("id",e.dataset.listId),await fetch(`${t}/lists/${e.dataset.listId}`,{method:"PATCH",body:a})})},handleButtonshowListModalElem:function(){document.querySelector("#addListModal").classList.add("is-active")},handleDragCard(t){const e=t.from;console.log(t);const o=e.querySelectorAll(".box"),a=t.from.closest(".panel").dataset.listId;if(s.updateCardPosition(o,a),t.from!==t.to){const e=t.to,o=e.querySelectorAll(".box"),a=e.closest(".panel").dataset.listId;s.updateCardPosition(o,a)}},handleShowEditForm:function(t){t.target.classList.add("is-hidden"),t.target.nextElementSibling.classList.remove("is-hidden")},handleDeleteList:async function(e){if(e.preventDefault(),!confirm("voulez-vous vraiment supprimer cette liste ? "))return;const o=e.target.closest(".is-one-quarter").dataset.listId;console.log("dataset",e.target.closest(".is-one-quarter").dataset),console.log("LIST ID : ",o);try{204===(await fetch(`${t}/lists/${o}`,{method:"DELETE"})).status&&e.target.closest(".is-one-quarter").remove()}catch(a){console.log(a)}},handleSubmitEditList:async function(e){e.preventDefault();const o=new FormData(e.target);try{if(!o.get("name"))throw alert("Form issue"),new Error("form issue");const a=await fetch(`${t}/lists/${o.get("list-id")}`,{method:"PATCH",body:o}),n=await a.json();200===a.status&&(e.target.previousElementSibling.textContent=n.name)}catch(a){console.log(a)}e.target.classList.add("is-hidden"),e.target.previousElementSibling.classList.remove("is-hidden")},handleAddListForm:async function(e){e.preventDefault();const o=new FormData(e.target);s.handleButtonsHideModalElem();try{const e=await fetch(t+"/lists",{method:"POST",body:o});if(console.log(e),201!==e.status)throw new Error("POST API issue");{const t=await e.json();s.makeListInDOM(t)}}catch(a){console.log(a)}},handleButtonsHideModalElem:function(){document.querySelector("#addListModal").classList.remove("is-active")}};var l=s;const r={init:function(){console.log("app.init !"),r.getListFromAPI(),r.addListenerToActions()},async getListFromAPI(){try{const e=await fetch(t+"/lists"),a=await e.json();console.log(a);const s=a.sort((t,e)=>t.position-e.position);for(const t of s){console.log(t),l.makeListInDOM(t),console.log("list ",t);const e=t.cardList.sort((t,e)=>t.position-e.position);for(const t of e){n.makeCardInDom(t),console.log(t);for(const e of t.tags)o.makeTagInDOM(e)}}}catch(e){console.trace(e),alert("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es")}},addListenerToActions:function(){document.querySelector("#addListButton").addEventListener("click",l.handleButtonshowListModalElem);const t=document.querySelectorAll("#addListModal .close");for(const n of t)n.addEventListener("click",l.handleButtonsHideModalElem);document.querySelector(".modal-background").addEventListener("click",l.handleButtonsHideModalElem);const e=document.querySelectorAll("#addCardModal .close");for(const l of e)l.addEventListener("click",n.handleButtonsHideCardModalElem);const o=document.querySelectorAll(".modal-background");for(const l of o)l.addEventListener("click",n.handleButtonsHideCardModalElem);document.querySelector("#addListModal form").addEventListener("submit",l.handleAddListForm),document.querySelector("#addCardModal form").addEventListener("submit",n.handleAddCardForm);const a=document.querySelectorAll(".panel .is-pulled-right");for(const l of a)l.addEventListener("click",n.handleButtonShowCardModal);const s=document.querySelector(".card-lists");new Sortable(s,{group:"board",draggable:".panel",onEnd:l.handleDragList})}};document.addEventListener("DOMContentLoaded",r.init)}();